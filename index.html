<!-- Updated: 2026-01-27 with round numbers in all views -->
<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5, user-scalable=yes" />
  
  <!-- build: v4.3 IMPROVED DESIGN -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
<title>×œ×•×— ××©×—×§×™× â€¢ ×’×œ×™×œ ×¢×œ×™×•×Ÿ [v2.4-FIXED]</title>
  <style>
:root{
  /* Modern color palette - Light Mode */
  --bg1: #e0f2fe;
  --bg2: #ddd6fe;
  --card: #ffffff;
  --border: rgba(15,23,42,0.08);
  --text: #0f172a;
  --muted: #64748b;

  /* Pill colors - softer tones */
  --pill-bg: #f1f5f9;
  --pill-border: #cbd5e1;
  --pill-text: #334155;

  /* Score colors - default is gray for pending */
  --score-bg: #f1f5f9;
  --score-border: #cbd5e1;
  --score-text: #475569;

  /* Button colors - modern gradient */
  --btn-primary: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
  --btn-hover: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
  
  /* Active tab - vibrant but professional */
  --tab-active: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
  
  --shadow-sm: 0 1px 3px rgba(15,23,42,0.08);
  --shadow: 0 4px 16px rgba(15,23,42,0.10);
  --shadow-lg: 0 10px 40px rgba(15,23,42,0.15);
  --radius: 16px;
}

  }
  .calendarGrid{
    grid-template-columns: 1fr;
  }
}

[data-theme="dark"] .modalOverlay{
  background: rgba(0,0,0,0.95);
}

*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  font-family: system-ui,-apple-system,"Segoe UI",Arial,"Noto Sans Hebrew",sans-serif;
  color:var(--text);
  background: radial-gradient(1200px 600px at 15% 10%, var(--bg1), transparent 70%),
              radial-gradient(1200px 600px at 85% 10%, var(--bg2), transparent 70%),
              #f8fafc;
  line-height: 1.6;
}

.wrap{max-width:1180px; margin:0 auto; padding:18px 14px 40px;}
.header{
  text-align:center;
  margin:10px 0 20px;
}
.header h1{
  margin:0; 
  font-size:32px; 
  letter-spacing:.2px;
  background: linear-gradient(135deg, #1e40af 0%, #7c3aed 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  font-weight: 800;
}
.header p{margin:8px 0 0; color:var(--muted); font-size:15px;}

.card{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:var(--radius);
  box-shadow: var(--shadow);
  transition: all 0.3s ease;
}

.card:hover{
  box-shadow: var(--shadow-lg);
}

.controls{
  padding:16px;
  display:grid;
  grid-template-columns: 1fr;
  gap:12px;
  margin-bottom:16px;
}
.controlsRow{
  display:flex;
  gap:12px;
  align-items:center;
  justify-content:center;
  flex-wrap:wrap;
}
.roundBox{
  display:flex;
  align-items:center;
  gap:12px;
  background: rgba(15,23,42,0.02);
  border:1px solid var(--border);
  border-radius: 12px;
  padding:10px 14px;
  transition: all 0.2s ease;
}
.roundBox:hover{
  background: rgba(15,23,42,0.04);
}
.iconBtn{
  border:1px solid var(--border);
  background:#fff;
  border-radius:10px;
  padding:8px 12px;
  cursor:pointer;
  line-height:1;
  transition: all 0.2s ease;
  font-weight: 600;
  color: var(--text);
}
.iconBtn:hover{
  background: var(--pill-bg);
  border-color: var(--pill-border);
  transform: translateY(-1px);
}
.iconBtn:active{transform:translateY(0)}
.iconBtn:disabled{
  opacity: 0.4;
  cursor: not-allowed;
}
.iconBtn:disabled:hover{
  transform: none;
  background: #fff;
}

.jumpBtn{
  border: 1px solid var(--border);
  background: linear-gradient(135deg, #10b981 0%, #059669 100%);
  border-radius: 10px;
  padding: 8px 16px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s ease;
  color: #ffffff;
  font-size: 13px;
  margin-top: 8px;
  box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);
}
.jumpBtn:hover{
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
}
.jumpBtn:active{
  transform: translateY(0);
}

.select{
  border:1px solid var(--border);
  background:#fff;
  border-radius:12px;
  padding:10px 14px;
  min-width: 230px;
  font-weight:600;
  cursor: pointer;
  transition: all 0.2s ease;
  color: var(--text);
}
.select:hover{
  border-color: var(--pill-border);
}
.select:focus{
  outline: 2px solid #93c5fd;
  outline-offset: 2px;
}

.search{
  width:100%;
  border:1px solid var(--border);
  border-radius: 12px;
  padding:12px 14px;
  font-size:15px;
  transition: all 0.2s ease;
}
.search:focus{
  outline: none;
  border-color: #93c5fd;
  box-shadow: 0 0 0 3px rgba(59,130,246,0.1);
}

.sub{
  color:var(--muted); 
  font-size:13px;
  text-align:center;
  width:100%;
}

.tabs{
  margin:12px 0 16px;
  display:flex;
  gap:10px;
}
.tabBtn{
  flex:1;
  border:1px solid var(--border);
  background:#fff;
  border-radius: 12px;
  padding:14px 16px;
  font-weight:700;
  cursor:pointer;
  transition: all 0.3s ease;
  color: var(--text);
  font-size: 15px;
}
.tabBtn:hover{
  background: var(--pill-bg);
  border-color: var(--pill-border);
  transform: translateY(-2px);
  box-shadow: var(--shadow);
}
.tabBtn.active{
  background: var(--tab-active);
  color:#fff;
  border-color: transparent;
  box-shadow: 0 4px 12px rgba(99,102,241,0.3);
}
.tabBtn.active:hover{
  transform: translateY(-2px);
}

.grid{
  display:grid;
  grid-template-columns: 1fr;
  gap:16px;
}

.panelTitle{
  margin:0 0 12px;
  font-size:22px;
  font-weight: 800;
  color: var(--text);
}

.scroll{
  overflow-x:auto;
  overflow-y:visible;
  max-height:none;
  border-radius: 12px;
  border: 1px solid var(--border);
  -webkit-overflow-scrolling: touch;
}

table{width:100%; border-collapse:separate; border-spacing:0;}
th,td{
  padding:14px 12px;
  border-bottom:1px solid rgba(15,23,42,0.06);
  text-align:right;
  vertical-align:middle;
  white-space:nowrap;
}
th{
  font-size:13px; 
  color:var(--muted); 
  background:rgba(15,23,42,0.02); 
  position:sticky; 
  top:0;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}
tr:last-child td{border-bottom:none;}
tr.hl{
  background: rgba(34,197,94,0.08);
  animation: highlightPulse 0.3s ease;
}
tr.hl2{
  background: rgba(245,158,11,0.12);
  animation: highlightPulse 0.3s ease;
}
tr.standRow{
  cursor: pointer;
  transition: all 0.2s ease;
}
tr.standRow:hover{
  background: rgba(15,23,42,0.03);
  transform: translateX(-2px);
}

@keyframes highlightPulse {
  0% { opacity: 0.5; }
  100% { opacity: 1; }
}

@keyframes pulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.05); box-shadow: 0 8px 24px rgba(59, 130, 246, 0.4); }
  100% { transform: scale(1); }
}

.teamLink,.teamPill{
  display:inline-block;
  padding:8px 14px;
  border-radius: 10px;
  background: var(--pill-bg);
  border:1px solid var(--pill-border);
  color: var(--pill-text);
  text-decoration:none;
  font-weight:700;
  max-width: 360px;
  overflow:hidden;
  text-overflow:ellipsis;
  white-space:nowrap;
  transition: all 0.2s ease;
  cursor: pointer;
}
.teamLink:hover,.teamPill:hover{
  background:#e0e7ff;
  border-color: #a5b4fc;
  transform: translateY(-1px);
  box-shadow: var(--shadow-sm);
}

.scoreBadge{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  min-width: 64px;
  padding:7px 12px;
  border-radius: 10px;
  background: var(--score-bg);
  border:1px solid var(--score-border);
  color: var(--score-text);
  font-weight:900;
  font-size: 14px;
}
.scoreBadge.win{
  background: #dcfce7;
  border-color: #86efac;
  color: #14532d;
}
.scoreBadge.draw{
  background: #fef3c7;
  border-color: #fbbf24;
  color: #78350f;
}
.scoreBadge.lose{
  background: #fee2e2;
  border-color: #fca5a5;
  color: #7f1d1d;
}
.scoreBadge.other{
  background: #f1f5f9;
  border-color: #cbd5e1;
  color: #64748b;
}
td.scoreCell{text-align:center;}

.gamesCards{display:none;}
.gameCard{display:none;} /* only mobile */

@media (max-width: 720px){
  body{
    padding: 0;
    margin: 0;
  }
  .wrap{
    padding: 0;
    margin: 0;
    max-width: 100%;
    width: 100%;
  }
  .header{
    margin: 0;
    padding: 16px 16px 12px;
    background: linear-gradient(135deg, #dbeafe 0%, #e0e7ff 100%);
    width: 100%;
  }
  .header h1{
    font-size: 22px;
    margin: 0 0 4px;
  }
  .header p{
    font-size: 12px;
    margin: 0;
    line-height: 1.3;
  }
  
  .topBar{
    padding: 10px 16px;
    margin: 0;
    background: #f8fafc;
    width: 100%;
    flex-direction: row;
    gap: 10px;
    flex-wrap: wrap;
  }
  .filterGroup{
    width: 100%;
    justify-content: stretch;
    gap: 8px;
  }
  .filterBtn{
    flex: 1;
    padding: 11px 10px;
    font-size: 13px;
    white-space: nowrap;
  }
  .themeToggle{
    padding: 11px 16px;
    font-size: 14px;
  }
  
  #errorBox{
    margin: 14px 16px;
    border-radius: 12px;
  }
  
  .controls{
    padding: 12px 0;
    margin: 0;
    border-radius: 0;
    border-left: none;
    border-right: none;
    border-top: none;
    border-bottom: 1px solid var(--border);
    width: 100%;
    background: transparent;
  }
  .controlsRow{
    justify-content: center;
    gap: 12px;
    flex-direction: column;
    align-items: center;
  }
  .roundBox{
    padding: 10px 16px;
    gap: 10px;
    max-width: calc(100% - 32px);
    margin: 0 16px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 12px;
    box-shadow: var(--shadow);
  }
  .iconBtn{
    padding: 12px 16px;
    font-size: 20px;
    min-width: 48px;
    height: 48px;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .select{
    min-width: 0;
    flex: 1;
    font-size: 15px;
    padding: 12px 16px;
  }
  .sub{
    font-size: 12px;
    margin-top: 6px;
    width: 100%;
    text-align: center;
  }
  
  .tabs{
    gap: 8px;
    margin: 0 16px;
    margin-bottom: 12px;
    padding: 10px;
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 12px;
    box-shadow: var(--shadow);
    display: flex;
  }
  .tabBtn{
    padding: 12px 10px;
    font-size: 14px;
    flex: 1;
  }
  
  .grid{
    padding: 0;
    margin: 0;
    width: 100%;
  }
  
  .card{
    border-radius: 0;
    border-left: none;
    border-right: none;
    margin: 0;
    width: 100%;
  }
  
  .panelTitle{
    font-size: 20px;
    padding: 18px 16px 14px;
    margin: 0;
  }
  
  /* Switch to cards view on mobile */
  .gamesTable{display: none;}
  .gamesCards{
    display: block;
    padding: 0 16px 20px;
    width: 100%;
  }
  .gamesCards .gameCard{
    display: block;
    margin: 8px 0;
    padding: 10px;
    border: 1px solid var(--border);
    border-radius: 12px;
    background: var(--card);
    box-shadow: var(--shadow);
    transition: all 0.2s ease;
  }
  .gamesCards .gameCard.hl{
    background: rgba(34,197,94,0.1);
    border-color: rgba(34,197,94,0.4);
    box-shadow: 0 2px 8px rgba(34,197,94,0.2);
  }
  .gamesCards .gameCard:active{
    transform: scale(0.98);
  }
  .gcRow{
    display: grid;
    grid-template-columns: 1fr auto 1fr;
    gap: 8px;
    align-items: center;
  }
  .gcTeam{
    text-align: center;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 3px;
  }
  .gcTeam .teamLink{
    max-width: 100%;
    text-align: center;
    font-size: 12px;
    padding: 6px 8px;
    word-break: break-word;
    line-height: 1.2;
    display: inline-block;
  }
  .gcScore{
    text-align: center;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 5px;
  }
  .gcScore .scoreBadge{
    font-size: 15px;
    font-weight: 900;
    padding: 6px 10px;
    min-width: 55px;
  }
  .matchMeta{
    color: var(--muted);
    font-size: 11px;
    white-space: nowrap;
  }
  .teamName.winner{
    color: #059669;
    font-weight: 700;
  }
  .teamName.loser{
    color: var(--muted);
    font-weight: 700;
  }
  
  /* Standings table */
  .scroll{
    border-radius: 0;
    border-left: none;
    border-right: none;
    overflow-x: auto;
    width: 100%;
  }
  th, td{
    padding: 14px 10px;
    font-size: 14px;
  }
  .teamLink{
    padding: 7px 11px;
    font-size: 13px;
  }
  .scoreBadge{
    padding: 7px 11px;
    min-width: 55px;
    font-size: 14px;
  }
}

/* FIXED: Modal always centered on all screens */
.modalOverlay{
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.92);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 99999;
  padding: 20px;
  animation: fadeIn 0.2s ease;
}
.modalOverlay.open{
  display:flex;
}

/* Prevent body scroll when modal is open */
body.modal-open{
  overflow: hidden;
  position: fixed;
  width: 100%;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

@keyframes slideUp {
  from { 
    opacity: 0;
    transform: translateY(20px) scale(0.95);
  }
  to { 
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

.modal{
  width: min(780px, 100%);
  max-height: 85vh;
  background:#fff;
  border:1px solid var(--border);
  border-radius: 20px;
  box-shadow: 0 20px 60px rgba(0,0,0,0.25);
  overflow:hidden;
  display:flex;
  flex-direction:column;
  animation: slideUp 0.3s ease;
}
.modalHeader{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
  padding: 16px 18px;
  border-bottom: 1px solid rgba(15,23,42,0.08);
  background: linear-gradient(to bottom, rgba(249,250,251,1), rgba(255,255,255,1));
}
.modalTitle{
  font-weight:800;
  font-size: 20px;
  color: var(--text);
}
.modalBody{
  padding: 18px;
  overflow:auto;
  max-width:100%;
}
.modalBody table{
  width:100%;
  max-width:100%;
  table-layout:fixed;
}
.modalBody th,
.modalBody td{
  overflow:hidden;
  text-overflow:ellipsis;
  white-space:nowrap;
  padding:8px 6px;
  font-size:13px;
}

/* Mobile adjustments - but keep centered */
@media (max-width: 720px){
  .modalOverlay{
    padding: 14px;
  }
  .modal{
    max-height: 90vh;
    border-radius: 16px;
    width:calc(100% - 28px);
  }
  .modalBody{
    padding:14px;
  }
  .modalBody table{
    display:block;
    overflow-x:auto;
    white-space:nowrap;
  }
  .header h1{
    font-size: 26px;
  }
  .kpis{
    grid-template-columns:1fr;
  }
  .kpi{
    padding:12px;
  }
  .sectionTitle{
    font-size:15px;
  }
  .badges{
    gap:6px;
  }
  .badge{
    font-size:11px;
    padding:5px 10px;
  }
}

/* Error box styling */
#errorBox {
  background: #fee;
  border: 1px solid #fcc;
  color: #c33;
  padding: 16px;
  border-radius: 12px;
  margin: 16px 0;
  display: none;
  font-size: 14px;
  line-height: 1.6;
}

/* Tab panels */
.tab-panel{display:none;}
.tab-panel.active{display:block;}

/* Team modal specific styles */
.kpis{
  display:grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap:14px;
  margin-bottom:20px;
}
.kpi{
  background: var(--pill-bg);
  border:1px solid var(--pill-border);
  border-radius: 12px;
  padding:14px;
  text-align:center;
}
.kpi .label{
  font-size:13px;
  color:var(--muted);
  font-weight:600;
  margin-bottom:6px;
}
.kpi .value{
  font-size:18px;
  font-weight:800;
  color:var(--text);
}

.sectionTitle{
  font-size:17px;
  font-weight:800;
  margin:20px 0 12px;
  color:var(--text);
}

.badges{
  display:flex;
  flex-wrap:wrap;
  gap:8px;
  align-items:center;
}

.badge{
  padding:6px 12px;
  border-radius: 8px;
  font-size:13px;
  font-weight:700;
  display:inline-flex;
  align-items:center;
  gap:6px;
}
.badge.win{
  background:#dcfce7;
  border:1px solid #86efac;
  color:#14532d;
}
.badge.lose{
  background:#fee2e2;
  border:1px solid #fca5a5;
  color:#7f1d1d;
}
.badge.draw{
  background:#fef3c7;
  border:1px solid #fcd34d;
  color:#78350f;
}
.badge.pending{
  background:var(--pill-bg);
  border:1px solid var(--pill-border);
  color:var(--pill-text);
}

.tiny{
  font-size:13px;
  color:var(--muted);
  font-style:italic;
}

/* Close button */
button[id*="Close"]{
  background:none;
  border:none;
  font-size:28px;
  line-height:1;
  cursor:pointer;
  color:var(--muted);
  padding:4px 8px;
  border-radius:8px;
  transition: all 0.2s ease;
}
button[id*="Close"]:hover{
  background:rgba(15,23,42,0.06);
  color:var(--text);
}

/* Loading Spinner */
.spinner{
  display:inline-block;
  width:40px;
  height:40px;
  border:4px solid var(--pill-border);
  border-top-color:var(--tab-active);
  border-radius:50%;
  animation:spin 0.8s linear infinite;
}
@keyframes spin{
  to{transform:rotate(360deg);}
}
.loading-overlay{
  position:fixed;
  inset:0;
  background:rgba(15,23,42,0.5);
  backdrop-filter:blur(2px);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:9998;
}
.loading-overlay.show{display:flex;}

/* Theme Toggle & Filters Bar */
.topBar{
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:12px;
  margin-bottom:12px;
  flex-wrap:wrap;
}
.filterGroup{
  display:flex;
  gap:8px;
  align-items:center;
  flex-wrap:wrap;
}
.themeToggle{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:10px;
  padding:8px 12px;
  cursor:pointer;
  display:flex;
  align-items:center;
  gap:6px;
  font-size:14px;
  font-weight:600;
  color:var(--text);
  transition:all 0.2s ease;
}
.themeToggle:hover{
  background:var(--pill-bg);
  border-color:var(--pill-border);
}
.filterBtn{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:10px;
  padding:8px 14px;
  cursor:pointer;
  font-size:13px;
  font-weight:600;
  color:var(--text);
  transition:all 0.2s ease;
}
.filterBtn:hover{
  background:var(--pill-bg);
}
.filterBtn.active{
  background:var(--tab-active);
  color:#fff;
  border-color:transparent;
}

/* Calendar View */
.calendarView{
  display:none;
}
.calendarView.active{
  display:block;
}
.calendarGrid{
  display:grid;
  grid-template-columns:repeat(auto-fill, minmax(280px, 1fr));
  gap:14px;
  margin-top:12px;
}
.calendarDay{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:12px;
  padding:14px;
  box-shadow:var(--shadow-sm);
  transition: all 0.2s ease;
}
.calendarDay.hasCurrentRound{
  border:2px solid #3b82f6;
  box-shadow:0 4px 16px rgba(59, 130, 246, 0.2);
}
.calendarDay:hover{
  box-shadow:var(--shadow);
  transform: translateY(-2px);
}
.dayHeader{
  font-weight:700;
  font-size:13px;
  color:var(--text);
  margin-bottom:10px;
  padding-bottom:8px;
  border-bottom:1px solid var(--border);
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.dayGames{
  display:flex;
  flex-direction:column;
  gap:6px;
}
.miniGame{
  font-size:11px;
  padding:8px 10px;
  background:var(--pill-bg);
  border-radius:8px;
  color:var(--text);
  line-height:1.4;
  display:flex;
  align-items:flex-start;
  gap:8px;
  justify-content:space-between;
  border:1px solid transparent;
  min-height:32px;
}
.miniGame.currentRound{
  border:1px solid #3b82f6;
  background:rgba(59, 130, 246, 0.08);
}
.miniGame .teams{
  flex:1;
  overflow:visible;
  white-space:normal;
  line-height:1.3;
}
.miniGame .score{
  font-weight:900;
  font-size:12px;
  padding:3px 6px;
  border-radius:6px;
  min-width:45px;
  text-align:center;
  flex-shrink:0;
}
.miniGame.highlight{
  background:rgba(34,197,94,0.15);
  border:1px solid rgba(34,197,94,0.3);
}
.miniGame.highlight .score{
  background:#dcfce7;
  color:#14532d;
}
.miniGame .score.win{
  background:#dcfce7;
  border:1px solid #86efac;
  color:#14532d;
}
.miniGame .score.lose{
  background:#fee2e2;
  border:1px solid #fca5a5;
  color:#7f1d1d;
}
.miniGame .score.draw{
  background:#fef3c7;
  border:1px solid #fbbf24;
  color:#78350f;
}
.gameCount{
  font-size:11px;
  color:var(--muted);
  font-weight:600;
}

/* Improved responsiveness */
@media (max-width: 720px){
  .wrap{padding: 12px 10px 60px;}
  .header{margin: 8px 0 16px;}
  .header h1{font-size:24px;}
  .header p{font-size:14px;}
  .controls{padding:12px;}
  .controlsRow{gap:10px;}
  .roundBox{
    padding:8px 12px;
    gap:8px;
  }
  .iconBtn{
    padding:10px 14px;
    font-size:16px;
  }
  .select{
    min-width:150px; 
    font-size:14px;
    padding:10px 12px;
  }
  .tabs{
    gap:8px;
    margin:10px 0 14px;
  }
  .tabBtn{
    padding:12px 14px;
    font-size:14px;
  }
  .panelTitle{
    font-size:18px;
  }
  .card{
    border-radius:14px;
  }
  /* Better table scrolling on mobile */
  .scroll{
    border-radius:10px;
  }
  th, td{
    padding:10px 8px;
    font-size:13px;
  }
  .teamLink{
    padding:6px 10px;
    font-size:13px;
  }
  .scoreBadge{
    padding:6px 10px;
    min-width:50px;
    font-size:13px;
  }
}

@media (max-width: 480px){
  .header h1{font-size:22px;}
  .header p{font-size:13px; line-height:1.5;}
  .roundBox{
    flex-wrap:wrap;
    justify-content:center;
  }
  .select{
    min-width:120px;
    font-size:13px;
  }
  .iconBtn{
    padding:8px 12px;
  }
  th, td{
    padding:8px 6px;
    font-size:12px;
  }
  .teamLink{
    padding:5px 8px;
    font-size:12px;
    max-width:140px;
  }
  .scoreBadge{
    min-width:45px;
    font-size:12px;
  }
  /* Make modal KPIs stack on very small screens */
  .kpis{
    grid-template-columns: 1fr;
  }
}
</style>
  <!-- PWA / Home Screen -->
  <link rel="manifest" href="manifest.webmanifest" crossorigin="use-credentials" />
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>âš½</text></svg>" />
</head>
<body>
  <div class="wrap">
    <div class="header">
      <h1>×œ×•×— ××©×—×§×™× â€¢ ×’×œ×™×œ ×¢×œ×™×•×Ÿ</h1>
      <p>×œ×•×— ××©×—×§×™× ×•×ª×•×¦××•×ª ××¢×•×“×›× ×™× ×‘×’'×œ×™×œ â€” ×”×ª×¦×•×’×” ××ª×¢×“×›× ×ª ×œ×¤×™ × ×ª×•× ×™× ×¢×“×›× ×™×™×!</p>
    </div>

    <div class="topBar">
      <div class="filterGroup">
        <button class="filterBtn active" data-filter="all">×”×›×œ</button>
        <button class="filterBtn" data-filter="upcoming">××©×—×§×™× ×¢×ª×™×“×™×™×</button>
        <button class="filterBtn" data-filter="past">××©×—×§×™× ×©×¢×‘×¨×•</button>
      </div>
    </div>

    <div id="errorBox"></div>

    <div class="card controls">
      <div class="controlsRow">
        <div class="roundBox">
          <button id="roundPrev" class="iconBtn">â†’</button>
          <select id="roundSelect" class="select" aria-label="×‘×—×¨ ××—×–×•×¨"></select>
          <button id="roundNext" class="iconBtn">â†</button>
        </div>
        <button id="jumpToCurrentRound" class="jumpBtn" style="display:none;">ğŸ“ ×§×¤×™×¦×” ×œ××—×–×•×¨ ×”×‘×</button>
        <span id="roundStatus" class="sub"></span>
      </div>
      <!-- ×”××ª×¨ ×××•×§×“ ×‘×”×¤×•×¢×œ ×’×œ×™×œ ×¢×œ×™×•×Ÿ: ×¡×™× ×•×Ÿ ×”×§×‘×•×¦×” ×§×‘×•×¢ ×•××•×¡×ª×¨ -->
      <input id="teamFilter" value="×”×¤×³ ×’×œ×™×œ ×¢×œ×™×•×Ÿ" type="hidden" />
      <input type="checkbox" id="onlyTeam" checked style="display:none" />
    </div>

    <div class="tabs" role="tablist">
      <button class="tabBtn active" data-tab="games" role="tab" aria-selected="true">××©×—×§×™×</button>
      <button class="tabBtn" data-tab="standings" role="tab" aria-selected="false">×˜×‘×œ×”</button>
      <button class="tabBtn" data-tab="calendar" role="tab" aria-selected="false">×œ×•×— ×©× ×”</button>
    </div>

    <div class="grid">
      <div class="tab-panel active" data-panel="games">
        <div class="card">
          <div style="padding:16px 16px 12px">
            <h2 class="panelTitle">××©×—×§×™×</h2>
          </div>
          <div class="scroll gamesTable">
            <table>
              <thead>
                <tr>
                  <th>×ª××¨×™×š</th>
                  <th>××—×–×•×¨</th>
                  <th>×‘×™×ª</th>
                  <th style="text-align:center;">×ª×•×¦××”</th>
                  <th>×—×•×¥</th>
                </tr>
              </thead>
              <tbody id="gamesBody"></tbody>
            </table>
          </div>
          <div class="gamesCards" id="gamesCards"></div>
        </div>
      </div>

      <div class="tab-panel" data-panel="standings">
        <div class="card">
          <div style="padding:16px 16px 12px">
            <h2 class="panelTitle">×˜×‘×œ×ª ×œ×™×’×”</h2>
          </div>
          <div class="scroll">
            <table>
              <thead>
                <tr>
                  <th>#</th>
                  <th>×§×‘×•×¦×”</th>
                  <th>× ×§'</th>
                  <th>××©×—'</th>
                  <th>× ×¦'</th>
                  <th>×ª×™×§×•</th>
                  <th>×”×¤'</th>
                  <th>×‘×¢×“</th>
                  <th>× ×’×“</th>
                  <th>+/-</th>
                </tr>
              </thead>
              <tbody id="standBody"></tbody>
            </table>
          </div>
        </div>
      </div>

      <div class="tab-panel" data-panel="calendar">
        <div class="card">
          <div style="padding:16px 16px 12px; display:flex; justify-content:space-between; align-items:center;">
            <h2 class="panelTitle" style="margin:0;">×œ×•×— ×©× ×”</h2>
            <button id="scrollToCurrentInCalendar" class="jumpBtn" style="display:inline-block; margin:0;">ğŸ“ ×§×¤×•×¥ ×œ××©×—×§ ×”×‘×</button>
          </div>
          <div style="padding:0 16px 16px">
            <div id="calendarView" class="calendarGrid"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading Overlay -->
  <div class="loading-overlay" id="loadingOverlay">
    <div class="spinner"></div>
  </div>

  <!-- Team Modal -->
  <div class="modalOverlay" id="teamModalOverlay">
    <div class="modal">
      <div class="modalHeader">
        <div class="modalTitle" id="teamModalTitle">×˜×•×¢×Ÿ...</div>
        <button id="teamModalClose" aria-label="×¡×’×•×¨">Ã—</button>
      </div>
      <div class="modalBody" id="teamModalBody">
        <div style="text-align:center; padding:30px; color:var(--muted);">×˜×•×¢×Ÿ × ×ª×•× ×™×...</div>
      </div>
    </div>
  </div>

<script>
  let DATA = null;

  function fmtDate(s){
    if(!s) return "";
    try{
      const d = new Date(s);
      return d.toLocaleString("he-IL", { weekday:"short", year:"2-digit", month:"2-digit", day:"2-digit", hour:"2-digit", minute:"2-digit" });
    }catch{ return s; }
  }

  function normTeamName(s){
    return String(s||"")
      .toLowerCase()
      .replace(/["'×´×³`Â´]/g,"")
      .replace(/[\u05F3\u05F4]/g,"")      // geresh/gershayim
      .replace(/[\.\,\-â€“â€”\(\)\[\]\{\}:;!ØŸ?]/g," ")
      .replace(/\s+/g," ")
      .trim();
  }

  function isGalilQuery(qn){
    return qn.includes("×’×œ×™×œ") && qn.includes("×¢×œ×™×•×Ÿ");
  }

  function matchTeamName(name, q){
    const n = normTeamName(name);
    const qn = normTeamName(q);

    if(!qn) return false;

    // Special: focus on "×’×œ×™×œ ×¢×œ×™×•×Ÿ" regardless of abbreviation (×”×¤', ×”×¤×•×¢×œ, ×•×›×•')
    if(isGalilQuery(qn)){
      return n.includes("×’×œ×™×œ") && n.includes("×¢×œ×™×•×Ÿ");
    }

    // General: substring match on normalized strings
    return n.includes(qn) || qn.includes(n);
  }

  function includesTeam(game, q){
    if(!q) return false;
    return matchTeamName(game.home?.name || "", q) || matchTeamName(game.away?.name || "", q);
  }

  function normGoal(v){
    if(v === null || v === undefined || v === "") return null;
    const n = Number(v);
    if(!Number.isFinite(n)) return null;
    if(n < 0) return null; // API uses -1 for not played yet
    return n;
  }

  function formatScore(g){
    const hg = normGoal(g.home?.goals);
    const ag = normGoal(g.away?.goals);

    // Show score as away:home (reversed for display purposes)
    if(hg !== null && ag !== null){
      return String(ag) + ":" + String(hg);
    }
    return "×˜×¨×";
  }

  function esc(s){
    return String(s ?? "")
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;")
      .replaceAll("'","&#39;");
  }
  function escapeAttr(s){ return esc(s).replaceAll("`","&#96;"); }

  function buildOpponentLocation(g, focusTeamQ){
    // ×¢××•×“×ª "××¦×œ ××™" â€” ×‘×¨×™×¨×ª ××—×“×œ: ×”×§×‘×•×¦×” ×”×××¨×—×ª (×‘×™×ª)
    const h = (g.home?.name || "");
    const a = (g.away?.name || "");
    const q = (focusTeamQ || "").trim();
    if(!q) return h || (g?.venue || "");

    // ×× ×”××©×—×§ ×›×•×œ×œ ××ª ×’×œ×™×œ â€” × ×¦×™×’ ××ª ×”×™×¨×™×‘×” ×‘×¦×•×¨×” ×™×“×™×“×•×ª×™×ª
    if(matchTeamName(h, q) && a){
      return `×‘×™×ª ××•×œ ${a}`;
    }
    if(matchTeamName(a, q) && h){
      return `×—×•×¥ ××¦×œ ${h}`;
    }

    // ××©×—×§×™× ××—×¨×™× ×‘×œ×™×’×”: "××¦×œ ××™" = ×”×§×‘×•×¦×” ×‘×‘×™×ª
    return h || (g?.venue || "");
  }


  function teamOutcomeFor(g, teamQ){
    const q = (teamQ || "").trim().toLowerCase();
    const h = (g.home?.name || "");
    const a = (g.away?.name || "");
    const hg = normGoal(g.home?.goals);
    const ag = normGoal(g.away?.goals);
    if(hg === null || ag === null) return null; // not played
    if(!q) return null;

    const isHome = matchTeamName(h, teamQ);
    const isAway = matchTeamName(a, teamQ);
    if(!isHome && !isAway) return null;

    const my = isHome ? hg : ag;
    const opp = isHome ? ag : hg;
    if(my > opp) return "W";
    if(my < opp) return "L";
    return "D";
  }

  function openTeamModal(opponent){
    if(!DATA) return;
    const myTeamQ = (document.getElementById("teamFilter")?.value || "").trim() || "×’×œ×™×œ";
    const oppName = (opponent || "").trim();
    if(!oppName) return;

    const played = (DATA.games || []).filter(g => normGoal(g.home?.goals) !== null && normGoal(g.away?.goals) !== null);

    const h2h = played.filter(g=>{
      const h = (g.home?.name || "");
      const a = (g.away?.name || "");
      return (matchTeamName(h, myTeamQ) && matchTeamName(a, oppName)) || (matchTeamName(h, oppName) && matchTeamName(a, myTeamQ));
    }).sort((a,b)=>(b.date||"").localeCompare(a.date||""));

    const last = h2h[0] || null;
    const last5 = h2h.slice(0,5);

    let w=0,l=0,d=0;
    for(const g of h2h){
      const o = teamOutcomeFor(g, myTeamQ);
      if(o==="W") w++;
      else if(o==="L") l++;
      else if(o==="D") d++;
    }

    const last2 = h2h.slice(0,2);

    const recent = played
      .filter(g=>includesTeam(g, oppName))
      .sort((a,b)=>(b.date||"").localeCompare(a.date||""))
      .slice(0,5);

    const recentBadges = recent.map(g=>{
      const o = teamOutcomeFor(g, oppName);
      const score = formatScore(g);
      const opp = matchTeamName((g.home?.name||""), oppName) ? (g.away?.name||"") : (g.home?.name||"");
      const cls = o==="W" ? "win" : o==="L" ? "lose" : "draw";
      const label = o==="W" ? "× ×™×¦×—×•×Ÿ" : o==="L" ? "×”×¤×¡×“" : "×ª×™×§×•";
      return `<span class="badge ${cls}">${label} â€¢ ${esc(opp)} â€¢ ${esc(score)}</span>`;
    }).join("");

    const lastHtml = last2.length ? `
      <table class="smallTable" style="width:100%; border-collapse:collapse;">
        <tr>
          <th style="text-align:right; padding:8px; border-bottom:1px solid var(--border);">×ª××¨×™×š</th>
          <th style="text-align:right; padding:8px; border-bottom:1px solid var(--border);">××—×–×•×¨</th>
          <th style="text-align:right; padding:8px; border-bottom:1px solid var(--border);">××©×—×§</th>
          <th style="text-align:right; padding:8px; border-bottom:1px solid var(--border);">×ª×•×¦××”</th>
          <th style="text-align:right; padding:8px; border-bottom:1px solid var(--border);">×’×œ×™×œ</th>
        </tr>
        ${last2.map(g=>{
          const o = teamOutcomeFor(g, myTeamQ);
          const cls = o==="W" ? "win" : o==="L" ? "lose" : "draw";
          const label = o==="W" ? "× ×™×¦×—×•×Ÿ" : o==="L" ? "×”×¤×¡×“" : "×ª×™×§×•";
          return `
          <tr>
            <td style="padding:8px; border-bottom:1px solid var(--border); white-space:nowrap;">${esc(fmtDate(g.date))}</td>
            <td style="padding:8px; border-bottom:1px solid var(--border); text-align:center; font-size:12px; color:var(--muted);">${g.round?.number || ""}</td>
            <td style="padding:8px; border-bottom:1px solid var(--border); white-space:normal; word-break:break-word;">${esc(g.home?.name||"")} ××•×œ ${esc(g.away?.name||"")}</td>
            <td style="padding:8px; border-bottom:1px solid var(--border);"><b dir="ltr">${esc(formatScore(g))}</b></td>
            <td style="padding:8px; border-bottom:1px solid var(--border);"><span class="badge ${cls}">${label}</span></td>
          </tr>`;
        }).join("")}
      </table>
      <div class="tiny" style="margin-top:8px;">××•×¦×’×™× ×¢×“ ×©× ×™ ×”××©×—×§×™× ×”××—×¨×•× ×™× ×©×©×•×—×§×• ××•×œ ×’×œ×™×œ.</div>
    ` : `<div class="tiny">×œ× × ××¦× ××©×—×§ ×©×©×•×—×§ ×¢×“×™×™×Ÿ ×‘×™×Ÿ "${esc(myTeamQ)}" ×œ-"${esc(oppName)}".</div>`;

    // Find opponent's rank in standings
    const oppStanding = (DATA.standings || []).find(t => matchTeamName(t.name || "", oppName));
    const oppRank = oppStanding ? `#${oppStanding.rank}` : "×œ× ×™×“×•×¢";
    const oppPoints = oppStanding ? `${oppStanding.points} × ×§'` : "";

    const body = document.getElementById("teamModalBody");
    document.getElementById("teamModalTitle").textContent = `××•×œ ${oppName}`;
    body.innerHTML = `
      <div class="kpis">
        <div class="kpi"><div class="label">×××–×Ÿ ×’×œ×™×œ ××•×œ ×”×§×‘×•×¦×”</div><div class="value">${w} × ×¦×³ â€¢ ${l} ×”×¤×³${d?` â€¢ ${d} ×ª×™×§×•`:""}</div></div>
        <div class="kpi"><div class="label">×¡×”×´×› ××¤×’×©×™× ×©×©×•×—×§×•</div><div class="value">${h2h.length}</div></div>
        <div class="kpi"><div class="label">××™×§×•× ×”×§×‘×•×¦×”</div><div class="value">${oppRank}${oppPoints ? ` â€¢ ${oppPoints}` : ""}</div></div>
      </div>

      <div class="sectionTitle">×”××©×—×§×™× ×”××—×¨×•× ×™× ×‘×™× ×™×”×Ÿ</div>
      ${lastHtml}

      <div class="sectionTitle">5 ××©×—×§×™× ××—×¨×•× ×™× ×©×œ ×”×§×‘×•×¦×” (×›×œ×œ×™)</div>
      <div class="badges">${recentBadges || `<div class="tiny">××™×Ÿ × ×ª×•× ×™×.</div>`}</div>
    `;

    const ov = document.getElementById("teamModalOverlay");
    ov.classList.add("open");
    document.body.classList.add("modal-open");
  }

  function closeTeamModal(){
    document.getElementById("teamModalOverlay")?.classList.remove("open");
    document.body.classList.remove("modal-open");
  }

function showError(msg){
    const box = document.getElementById("errorBox");
    box.style.display = "block";
    box.innerHTML = msg;
  }
  function hideError(){
    const box = document.getElementById("errorBox");
    box.style.display = "none";
    box.innerHTML = "";
  }

  async function load(){
    showLoading();
    hideError();
    try{
      const r = await fetch("./data.json?ts=" + Date.now(), { cache: "no-store" });
      const t = await r.text();
      if(!r.ok){
        throw new Error("×œ× ×”×¦×œ×—×ª×™ ×œ×˜×¢×•×Ÿ ××ª ×§×•×‘×¥ <b>data.json</b>.<br>×•×“× ×©×›×œ ×”×§×‘×¦×™× ×”×•×¢×œ×• ×œ×¨×™×¤×• (×‘××™×•×—×“ <b>data.json</b>) ×•×œ× ×¨×§ index.html.<br><small>×¡×˜×˜×•×¡: " + r.status + " " + r.statusText + "</small>");
      }
      if(t.trim().startsWith("<")){
        throw new Error("× ×¨××” ×©×§×•×‘×¥ <b>data.json</b> ×œ× × ××¦× ×‘× ×ª×™×‘ ×”× ×•×›×—×™ (×”×ª×§×‘×œ×” ×ª×©×•×‘×ª HTML).<br>×”×¢×œ×” ××—×“×© ××ª ×›×œ ×”×§×‘×¦×™× ×›×•×œ×œ <b>data.json</b> ×•×‘×¦×¢ ×¨×¢× ×•×Ÿ ×§×©×™×—.");
      }
      try{
        DATA = JSON.parse(t);
      }catch(e){
        throw new Error("×§×•×‘×¥ data.json × ×˜×¢×Ÿ ××‘×œ ××™× ×• JSON ×ª×§×™×Ÿ.");
      }


      const leagueName = DATA?.league?.name || "×œ×™×’×”";
      const fetchedAt = DATA?.fetchedAt || "";
      const roundsCount = DATA?.rounds?.length || 0;
      const gamesCount = DATA?.gamesCount || 0;
      const shift = DATA?.api?.roundNumberShiftApplied ?? DATA?.api?.roundNumberFixApplied ?? 0;
const rs = (DATA.rounds || []).slice().sort((a,b)=>(a.number||0)-(b.number||0));
      const sel = document.getElementById("roundSelect");
      sel.innerHTML = "";
      for(const rr of rs){
        const opt = document.createElement("option");
        opt.value = rr.number;
        opt.textContent = `××—×–×•×¨ ${rr.number} (${rr.gamesCount || 0})`;
        sel.appendChild(opt);
      }

      const cur = DATA?.league?.currentRoundNumber;
      
      // Find the best round to display: upcoming round or most recent with games
      let bestRound = null;
      const now = new Date();
      
      // First, try to find the first round with future games
      for(const rr of rs){
        const roundGames = (DATA.games || []).filter(g => g.round?.number === rr.number);
        const hasFutureGames = roundGames.some(g => {
          if(!g.date) return false;
          const gameDate = new Date(g.date);
          return gameDate > now;
        });
        if(hasFutureGames){
          bestRound = rr.number;
          break;
        }
      }
      
      // If no future games found, use the last round with games, or API's current, or first round
      if(!bestRound){
        // Use the last round that has games
        for(let i = rs.length - 1; i >= 0; i--){
          if(rs[i].gamesCount > 0){
            bestRound = rs[i].number;
            break;
          }
        }
      }
      
      // Set the selected round
      if(bestRound) sel.value = String(bestRound);
      else if(cur) sel.value = String(cur);
      else if(rs.length) sel.value = String(rs[0].number);

      updateRoundStatus();
      render();
      hideLoading();
    }catch(e){
      showError(
        `<b>×œ× ×”×¦×œ×—×ª×™ ×œ×˜×¢×•×Ÿ × ×ª×•× ×™×.</b><br>
         ×× ×¤×ª×—×ª ××ª ×”×§×•×‘×¥ ×“×¨×š <code>file://</code> ×–×” ×œ× ×™×¢×‘×•×“ â€“ ×¤×ª×— ×“×¨×š ×©×¨×ª (GitHub Pages / Live Server).<br><br>
         ×©×’×™××”: <code>${String(e).replaceAll("<","&lt;").replaceAll(">","&gt;")}</code>`
      );
DATA = null;
      document.getElementById("roundSelect").innerHTML = "";
      document.getElementById("gamesBody").innerHTML = "";
      document.getElementById("standBody").innerHTML = "";
      hideLoading();
    }
  }

  
  function updateRoundStatus(){
    const sel = document.getElementById("roundSelect");
    const out = document.getElementById("roundStatus");
    if(!sel || !out) return;
    const total = sel.options.length || 0;
    const val = sel.value || "";
    out.textContent = total ? `××—×–×•×¨ ${val} ××ª×•×š ${total}` : "";
  }

function updateRoundButtons(){
    const sel = document.getElementById("roundSelect");
    const prev = document.getElementById("roundPrev");
    const next = document.getElementById("roundNext");
    const jumpBtn = document.getElementById("jumpToCurrentRound");
    if(!sel || !prev || !next) return;
    const i = sel.selectedIndex;
    prev.disabled = (i <= 0);
    next.disabled = (i >= sel.options.length - 1);
    
    // Show/hide jump button - check if we're at Galil's next game round
    if(jumpBtn && DATA){
      const currentRound = Number(sel.value);
      
      // Find Galil's next game round
      const now = new Date();
      const galilGames = (DATA.games || []).filter(g => includesTeam(g, '×’×œ×™×œ ×¢×œ×™×•×Ÿ'));
      const futureGalilGames = galilGames.filter(g => {
        if(!g.date) return false;
        return new Date(g.date) > now;
      }).sort((a,b)=>(a.date||"").localeCompare(b.date||""));
      
      const nextGalilRound = futureGalilGames[0]?.round?.number;
      
      if(nextGalilRound && currentRound !== nextGalilRound){
        jumpBtn.style.display = 'block';
      } else {
        jumpBtn.style.display = 'none';
      }
    }
  }

  function findBestRound(){
    if(!DATA) {
      console.log('findBestRound: no DATA');
      return null;
    }
    const rs = DATA.league?.rounds || [];
    const cur = DATA?.league?.currentRoundNumber;
    const now = new Date();
    
    console.log('findBestRound: checking', rs.length, 'rounds, cur=', cur);
    
    // First, try to find the first round with future games
    for(const rr of rs){
      const roundGames = (DATA.games || []).filter(g => g.round?.number === rr.number);
      const hasFutureGames = roundGames.some(g => {
        if(!g.date) return false;
        return new Date(g.date) > now;
      });
      if(hasFutureGames) {
        console.log('Best round found (with future games):', rr.number);
        return rr.number;
      }
    }
    
    // If no future games found, use the last round with games
    for(let i = rs.length - 1; i >= 0; i--){
      if(rs[i].gamesCount > 0) {
        console.log('Best round (last with games):', rs[i].number);
        return rs[i].number;
      }
    }
    
    // Fallback to API's current round
    if(cur) {
      console.log('Best round (API current):', cur);
      return cur;
    }
    
    // Last resort: first round
    if(rs.length) {
      console.log('Best round (first round):', rs[0].number);
      return rs[0].number;
    }
    
    console.log('No best round found at all');
    return null;
  }

  function jumpToCurrentRound(){
    const sel = document.getElementById("roundSelect");
    if(!sel || !DATA) return;
    
    // Find Galil Elyon's next game
    const now = new Date();
    const galilGames = (DATA.games || []).filter(g => includesTeam(g, '×’×œ×™×œ ×¢×œ×™×•×Ÿ'));
    const futureGalilGames = galilGames.filter(g => {
      if(!g.date) return false;
      return new Date(g.date) > now;
    }).sort((a,b)=>(a.date||"").localeCompare(b.date||""));
    
    const nextGalilGame = futureGalilGames[0];
    if(nextGalilGame && nextGalilGame.round?.number){
      console.log('Jumping to Galil next game in round:', nextGalilGame.round.number);
      sel.value = String(nextGalilGame.round.number);
      render();
    } else {
      console.log('No future Galil game found');
      // Fallback to findBestRound
      const bestRound = findBestRound();
      if(bestRound){
        sel.value = String(bestRound);
        render();
      }
    }
  }

  function scrollToCurrentInCalendar(){
    // First, make sure calendar is rendered
    const container = document.getElementById('calendarView');
    if(!container) {
      console.log('Calendar container not found');
      return;
    }
    
    // If calendar is empty, render it first
    if(container.innerHTML.trim() === ''){
      console.log('Calendar empty, rendering...');
      renderCalendar();
      // Wait for render to complete
      setTimeout(() => {
        doScroll();
      }, 200);
    } else {
      doScroll();
    }
    
    function doScroll(){
      const firstCurrentDay = container.querySelector('.calendarDay.hasCurrentRound');
      if(firstCurrentDay){
        console.log('Found next Galil game day, scrolling...');
        firstCurrentDay.scrollIntoView({ behavior: 'smooth', block: 'center' });
        // Add a pulse animation to highlight it
        firstCurrentDay.style.animation = 'pulse 1s ease';
        setTimeout(() => {
          firstCurrentDay.style.animation = '';
        }, 1000);
      } else {
        console.log('No next Galil game found in calendar');
      }
    }
  }

  function stepRound(delta){
    const sel = document.getElementById("roundSelect");
    if(!sel) return;
    const i = sel.selectedIndex;
    const ni = i + delta;
    if(ni < 0 || ni > sel.options.length - 1) return;
    sel.selectedIndex = ni;
    render();
  }

  function render(){
    if(!DATA) return;

    updateRoundButtons();
    updateRoundStatus();

    const roundNo = Number(document.getElementById("roundSelect").value);
    const teamQ = (document.getElementById("teamFilter")?.value || "").trim();
    let games = (DATA.games || []).filter(g => (g.round?.number ?? null) === roundNo);
    games.sort((a,b)=>(a.date||"").localeCompare(b.date||""));

    const body = document.getElementById("gamesBody");
    body.innerHTML = "";
    const cards = document.getElementById("gamesCards");
    if(cards) cards.innerHTML = "";
    
    for(const g of games){
      const tr = document.createElement("tr");
      const isTeam = includesTeam(g, teamQ);
      const score = formatScore(g);
      const hg = normGoal(g.home?.goals);
      const ag = normGoal(g.away?.goals);
      
      let out = "pending";
      if(hg !== null && ag !== null){
        if(hg > ag) out = "home";
        else if(ag > hg) out = "away";
        else out = "draw";
      }
      
      const badgeCls = (out==="home" || out==="away") ? "win" : (out==="draw" ? "draw" : "pending");
      
      tr.innerHTML = `
        <td style="white-space:nowrap;">${esc(fmtDate(g.date))}</td>
        <td style="text-align:center; font-size:13px; color:var(--muted);">${g.round?.number || ""}</td>
        <td>
          <button class="teamLink" data-team="${escapeAttr(g.home?.name || "")}">
            ${esc(g.home?.name || "")}
            <button class="favStar" data-fav="${escapeAttr(g.home?.name || "")}" onclick="event.stopPropagation();toggleFavorite('${escapeAttr(g.home?.name || "")}')">â˜…</button>
          </button>
        </td>
        <td style="text-align:center;"><span class="scoreBadge ${badgeCls}"><span class="score" dir="ltr">${score}</span></span></td>
        <td>
          <button class="teamLink" data-team="${escapeAttr(g.away?.name || "")}">
            ${esc(g.away?.name || "")}
            <button class="favStar" data-fav="${escapeAttr(g.away?.name || "")}" onclick="event.stopPropagation();toggleFavorite('${escapeAttr(g.away?.name || "")}')">â˜…</button>
          </button>
        </td>
      `;
      
      if(isTeam) tr.className = "hl";
      body.appendChild(tr);

      if(cards){
        const card = document.createElement("div");
        card.className = "gameCard" + (isTeam ? " hl" : "");
        const homeCls = (out==="home") ? "winner" : (out==="away" ? "loser" : "");
        const awayCls = (out==="away") ? "winner" : (out==="home" ? "loser" : "");
        const roundText = g.round?.number ? ` â€¢ ××—×–×•×¨ ${g.round.number}` : "";
        card.innerHTML = `
          <div class="gcRow">
            <div class="gcTeam gcHome"><button class="teamLink ${homeCls}" data-team="${escapeAttr(g.home?.name || "")}">${esc(g.home?.name || "")}</button></div>
            <div class="gcScore">
              <span class="scoreBadge ${badgeCls}"><span class="score" dir="ltr">${score}</span></span>
              <div class="matchMeta">${esc(fmtDate(g.date))}${roundText}</div>
            </div>
            <div class="gcTeam gcAway"><button class="teamLink ${awayCls}" data-team="${escapeAttr(g.away?.name || "")}">${esc(g.away?.name || "")}</button></div>
          </div>
        `;
        cards.appendChild(card);
      }
    }

    const sb = document.getElementById("standBody");
    sb.innerHTML = "";
    for(const t of (DATA.standings || [])){
      const tr = document.createElement("tr");
      tr.classList.add('standRow');
      tr.addEventListener('click', ()=> openTeamModal(t.name ?? ""));
      const isTeam = teamQ && matchTeamName((t.name||""), teamQ);
      tr.innerHTML = `
        <td>${t.rank ?? ""}</td>
        <td><button class="teamLink" data-team="${escapeAttr(t.name ?? "")}">${esc(t.name ?? "")}</button></td>
        <td><b>${t.points ?? ""}</b></td>
        <td>${t.games ?? ""}</td>
        <td>${t.wins ?? ""}</td>
        <td>${t.draws ?? ""}</td>
        <td>${t.losses ?? ""}</td>
        <td>${t.gf ?? ""}</td>
        <td>${t.ga ?? ""}</td>
        <td>${t.gd ?? ""}</td>
      `;
      if(isTeam) tr.className = "hl2";
      sb.appendChild(tr);
    }
  }
document.getElementById("roundSelect").onchange = render;
  document.getElementById("roundPrev").onclick = () => stepRound(-1);
  document.getElementById("roundNext").onclick = () => stepRound(1);
  document.getElementById("jumpToCurrentRound").onclick = jumpToCurrentRound;
  document.getElementById("teamFilter").oninput = render;
  document.getElementById("onlyTeam").onchange = render;

  document.addEventListener("click", (ev)=>{
    const btn = ev.target?.closest?.(".teamLink");
    if(!btn) return;
    const name = btn.getAttribute("data-team") || "";
    openTeamModal(name);
  });
  
  // Calendar jump button using event delegation
  document.addEventListener("click", (ev)=>{
    if(ev.target?.id === "scrollToCurrentInCalendar" || ev.target?.closest?.("#scrollToCurrentInCalendar")){
      console.log('Calendar jump button clicked!');
      ev.preventDefault();
      ev.stopPropagation();
      scrollToCurrentInCalendar();
    }
  });

  document.getElementById("teamModalClose")?.addEventListener("click", closeTeamModal);
  document.getElementById("teamModalOverlay")?.addEventListener("click", (e)=>{
    if(e.target?.id === "teamModalOverlay") closeTeamModal();
  });
  document.addEventListener("keydown", (e)=>{
    if(e.key === "Escape") closeTeamModal();
  });

  load();

// ========== NEW FEATURES ==========

// Favorites Management - Fixed to Galil Elyon only
const favorites = ['×”×¤×³ ×’×œ×™×œ ×¢×œ×™×•×Ÿ', '×”×¤×•×¢×œ ×’×œ×™×œ ×¢×œ×™×•×Ÿ', '×’×œ×™×œ ×¢×œ×™×•×Ÿ'];

function isFavoriteTeam(teamName){
  return favorites.some(f => matchTeamName(f, teamName));
}

// Date Filters
let currentFilter = 'all';

function setupFilters(){
  document.querySelectorAll('.filterBtn').forEach(btn => {
    btn.addEventListener('click', ()=>{
      document.querySelectorAll('.filterBtn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      currentFilter = btn.getAttribute('data-filter');
      render();
    });
  });
}
setupFilters();

// Loading Overlay
function showLoading(){
  document.getElementById('loadingOverlay')?.classList.add('show');
}

function hideLoading(){
  document.getElementById('loadingOverlay')?.classList.remove('show');
}

// Enhanced render with fade animation and filters
function renderWithAnimation(){
  const body = document.getElementById("gamesBody");
  const cards = document.getElementById("gamesCards");
  
  // Fade out animation
  if(body) body.style.opacity = '0';
  if(cards) cards.style.opacity = '0';
  
  setTimeout(()=>{
    renderActual();
    
    // Highlight is already done in renderActual for Galil teams
    
    // Fade in animation
    if(body){
      body.style.transition = 'opacity 0.3s ease';
      body.style.opacity = '1';
    }
    if(cards){
      cards.style.transition = 'opacity 0.3s ease';
      cards.style.opacity = '1';
    }
    
    renderCalendar();
  }, 150);
}

function renderActual(){
  if(!DATA) return;

  updateRoundButtons();
  updateRoundStatus();

  const roundNo = Number(document.getElementById("roundSelect").value);
  const teamQ = (document.getElementById("teamFilter")?.value || "").trim();
  let games = (DATA.games || []).filter(g => (g.round?.number ?? null) === roundNo);
  
  // Apply date filter
  if(currentFilter === 'upcoming'){
    const now = new Date();
    games = games.filter(g => {
      if(!g.date) return false;
      return new Date(g.date) > now;
    });
  } else if(currentFilter === 'past'){
    const now = new Date();
    games = games.filter(g => {
      if(!g.date) return true;
      return new Date(g.date) <= now;
    });
  }
  
  games.sort((a,b)=>(a.date||"").localeCompare(b.date||""));

  const body = document.getElementById("gamesBody");
  body.innerHTML = "";
  const cards = document.getElementById("gamesCards");
  if(cards) cards.innerHTML = "";
  
  for(const g of games){
    const tr = document.createElement("tr");
    const isTeam = includesTeam(g, teamQ);
    const score = formatScore(g);
    const hg = normGoal(g.home?.goals);
    const ag = normGoal(g.away?.goals);
    
    let out = "pending";
    let badgeCls = "pending";
    
    if(hg !== null && ag !== null){
      // Check if Galil is playing
      const isGalilHome = isFavoriteTeam(g.home?.name || "");
      const isGalilAway = isFavoriteTeam(g.away?.name || "");
      
      if(isGalilHome || isGalilAway){
        // Galil is playing - color by their result
        if(isGalilHome){
          if(hg > ag) badgeCls = "win";      // Galil won
          else if(hg < ag) badgeCls = "lose"; // Galil lost
          else badgeCls = "draw";             // Draw
        } else {
          if(ag > hg) badgeCls = "win";      // Galil won
          else if(ag < hg) badgeCls = "lose"; // Galil lost
          else badgeCls = "draw";             // Draw
        }
      } else {
        // Other teams - gray
        badgeCls = "other";
      }
      
      // Keep track of match outcome for other purposes
      if(hg > ag) out = "home";
      else if(ag > hg) out = "away";
      else out = "draw";
    }
    
    tr.innerHTML = `
      <td style="white-space:nowrap;">${esc(fmtDate(g.date))}</td>
      <td><button class="teamLink" data-team="${escapeAttr(g.home?.name || "")}">${esc(g.home?.name || "")}</button></td>
      <td style="text-align:center;"><span class="scoreBadge ${badgeCls}"><span class="score" dir="ltr">${score}</span></span></td>
      <td><button class="teamLink" data-team="${escapeAttr(g.away?.name || "")}">${esc(g.away?.name || "")}</button></td>
    `;
    
    if(isTeam) tr.className = "hl";
    body.appendChild(tr);

    if(cards){
      const card = document.createElement("div");
      card.className = "gameCard" + (isTeam ? " hl" : "");
      const homeCls = (out==="home") ? "winner" : (out==="away" ? "loser" : "");
      const awayCls = (out==="away") ? "winner" : (out==="home" ? "loser" : "");
      card.innerHTML = `
        <div class="gcRow">
          <div class="gcTeam gcHome"><button class="teamLink ${homeCls}" data-team="${escapeAttr(g.home?.name || "")}">${esc(g.home?.name || "")}</button></div>
          <div class="gcScore">
            <span class="scoreBadge ${badgeCls}"><span class="score" dir="ltr">${score}</span></span>
            <div class="matchMeta">${esc(fmtDate(g.date))}</div>
          </div>
          <div class="gcTeam gcAway"><button class="teamLink ${awayCls}" data-team="${escapeAttr(g.away?.name || "")}">${esc(g.away?.name || "")}</button></div>
        </div>
      `;
      cards.appendChild(card);
    }
  }

  const sb = document.getElementById("standBody");
  sb.innerHTML = "";
  for(const t of (DATA.standings || [])){
    const tr = document.createElement("tr");
    tr.classList.add('standRow');
    tr.addEventListener('click', ()=> openTeamModal(t.name ?? ""));
    const isTeam = teamQ && matchTeamName((t.name||""), teamQ);
    tr.innerHTML = `
      <td>${t.rank ?? ""}</td>
      <td><button class="teamLink" data-team="${escapeAttr(t.name ?? "")}">${esc(t.name ?? "")}</button></td>
      <td><b>${t.points ?? ""}</b></td>
      <td>${t.games ?? ""}</td>
      <td>${t.wins ?? ""}</td>
      <td>${t.draws ?? ""}</td>
      <td>${t.losses ?? ""}</td>
      <td>${t.gf ?? ""}</td>
      <td>${t.ga ?? ""}</td>
      <td>${t.gd ?? ""}</td>
    `;
    if(isTeam) tr.className = "hl2";
    sb.appendChild(tr);
  }
}

function render(){
  renderWithAnimation();
}

// Calendar View
function renderCalendar(){
  if(!DATA) return;
  const container = document.getElementById('calendarView');
  if(!container) return;
  
  const games = DATA.games || [];
  const dayMap = new Map();
  const now = new Date();
  
  // Find Galil Elyon's next game
  const galilGames = games.filter(g => includesTeam(g, '×’×œ×™×œ ×¢×œ×™×•×Ÿ'));
  const futureGalilGames = galilGames.filter(g => {
    if(!g.date) return false;
    return new Date(g.date) > now;
  }).sort((a,b)=>(a.date||"").localeCompare(b.date||""));
  
  const nextGalilGame = futureGalilGames[0];
  const nextGalilDate = nextGalilGame?.date ? new Date(nextGalilGame.date).toISOString().split('T')[0] : null;
  
  console.log('renderCalendar: next Galil game date =', nextGalilDate);
  
  games.forEach(g => {
    if(!g.date) return;
    const date = new Date(g.date);
    const dayKey = date.toISOString().split('T')[0];
    if(!dayMap.has(dayKey)){
      dayMap.set(dayKey, []);
    }
    dayMap.get(dayKey).push(g);
  });
  
  const sortedDays = Array.from(dayMap.entries()).sort((a,b) => a[0].localeCompare(b[0]));
  
  container.innerHTML = sortedDays.map(([dayKey, dayGames]) => {
    const date = new Date(dayKey);
    const dayName = date.toLocaleDateString('he-IL', { weekday: 'short', day: 'numeric', month: 'short' });
    
    // Check if this is the day with Galil's next game
    const hasNextGalilGame = dayKey === nextGalilDate;
    
    const gamesHtml = dayGames.map(g => {
      const isGalil = includesTeam(g, '×’×œ×™×œ ×¢×œ×™×•×Ÿ');
      const isNextGalilGame = isGalil && g.date && new Date(g.date).toISOString().split('T')[0] === nextGalilDate;
      const score = formatScore(g);
      const hg = normGoal(g.home?.goals);
      const ag = normGoal(g.away?.goals);
      
      let scoreCls = '';
      if(hg !== null && ag !== null){
        const isGalilHome = isFavoriteTeam(g.home?.name || "");
        const isGalilAway = isFavoriteTeam(g.away?.name || "");
        if(isGalilHome || isGalilAway){
          if(isGalilHome){
            if(hg > ag) scoreCls = 'win';
            else if(hg < ag) scoreCls = 'lose';
            else scoreCls = 'draw';
          } else {
            if(ag > hg) scoreCls = 'win';
            else if(ag < hg) scoreCls = 'lose';
            else scoreCls = 'draw';
          }
        }
      }
      
      const roundNum = g.round?.number ? `<span style="font-size:10px; opacity:0.7;">×${g.round.number}</span>` : '';
      
      return `
        <div class="miniGame ${isGalil ? 'highlight' : ''} ${isNextGalilGame ? 'currentRound' : ''}">
          <span class="teams">${esc(g.home?.name || '')} × ' ${esc(g.away?.name || '')} ${roundNum}</span>
          <span class="score ${scoreCls}" dir="ltr">${score}</span>
        </div>
      `;
    }).join('');
    
    return `
      <div class="calendarDay ${hasNextGalilGame ? 'hasCurrentRound' : ''}">
        <div class="dayHeader">
          <span>${esc(dayName)}${hasNextGalilGame ? ' ğŸ“' : ''}</span>
          <span class="gameCount">${dayGames.length} ××©×—×§×™×</span>
        </div>
        <div class="dayGames">${gamesHtml}</div>
      </div>
    `;
  }).join('');
  
  // Auto-scroll to first current round day
  setTimeout(() => {
    const firstCurrentDay = container.querySelector('.calendarDay.hasCurrentRound');
    if(firstCurrentDay){
      firstCurrentDay.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }
  }, 100);
}

</script>

<script>
(function(){
  const tabs = Array.from(document.querySelectorAll(".tabs [data-tab]"));
  const panels = Array.from(document.querySelectorAll(".tab-panel[data-panel]"));
  if(!tabs.length || !panels.length) return;

  function setAria(){
    tabs.forEach(btn=>{
      const on = btn.classList.contains("active");
      btn.setAttribute("aria-selected", on ? "true" : "false");
    });
  }

  function setTab(name){
    tabs.forEach(btn=>btn.classList.toggle("active", btn.dataset.tab === name));
    panels.forEach(p=>p.classList.toggle("active", p.dataset.panel === name));
    setAria();
    try{ localStorage.setItem("galil_active_tab", name); }catch(e){}
  }

  tabs.forEach(btn=>{
    btn.addEventListener("click", ()=> setTab(btn.dataset.tab));
  });

  let initial = "games";
  try{
    const saved = localStorage.getItem("galil_active_tab");
    if(saved) initial = saved;
  }catch(e){}
  setTab(initial);
})();
</script>

</body>
</html>
